\chapter{‘ункциональна€ архитектура}

\section{To be erased}
¬ разделе перечисл€ютс€ основные функции, подлежащие реализации, приводитс€ описание входных и выходных
параметров, их локализации в системной архитектуре программы. »зложение данного раздела должно опиратьс€
на функциональность пользовательских и программных интерфейсов (при наличии).

\section{‘ункции PAM модул€}
 ак уже упоминалось в разделе~\ref{implementation_problems_and_algos}, требуетс€ реализовать функции \t{pam\_sm\_authenticate} и \t{pam\_sm\_setcred}.

\subsection{\t{pam\_sm\_authenticate}}
\label{pam_sm_authenticate}
‘ункци€ аутентификации пользовател€. ќбъ€вление этой функции выгл€дит следующим образом:

\starttextblock
PAM_EXTERN int pam_sm_authenticate(pam_handle_t *pamh, int flags,
                                   int argc, const char **argv);
\end{lstlisting}

ќписание параметров функции:
\begin{itemize}
\item \t{pamh} --- хэндл PAM;
\item \t{flags} --- флаги, переданные модулю;
\item \t{argc}, \t{argv} --- параметры, переданные модулю.
\end{itemize}

¬озвращаемое значение отвечает за успешность аутентификации (это может быть тип ошибки).

¬нутри этой функции реализован алгоритм аутентификации, описанный в разделе~\ref{auth_algo}.

\subsection{\t{pam\_sm\_setcred}}
‘ункци€, настраивающа€ права пользовател€ после аутентификации. ќбъ€вление этой функции выгл€дит следующим образом:

\starttextblock

PAM_EXTERN int pam_sm_setcred(pam_handle_t *pamh, int flags,
                              int argc, const char **argv);
\end{lstlisting}

¬нутри этой функции написана заглушка, всегда возвращающа€ успешный результат, так как настройкой прав пользовател€ будут заниматьс€ другие модули.

\section{‘ункции шифровани€/дешифровани€}
Ѕыло решено сделать удобные обертки над функци€ми библиотеки \emph{openssl}. Ѕыли реализованы следующие функции:
\begin{enumerate}
\item \t{md5\_hash} Ч функци€, вычисл€юща€ \emph{md5}-хеш строки;
\item \t{aes\_encode} Ч функци€, шифрующа€ ключ с помощью парол€ алгоритмом шифровани€ AES;
\item \t{aes\_decode} Ч функци€, расшифровывающа€ ключ с помощью парол€ алгоритмом шифровани€ AES;
\item \t{base64\_encode} Ч функци€, перевод€ща€ массив байт в base64-строку;
\item \t{base64\_decode} Ч функци€, перевод€ша€ base64-строку в массив байт.
\end{enumerate}
