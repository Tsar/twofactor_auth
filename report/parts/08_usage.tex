\chapter{Порядок использования}

\section{Руководство для администратора}
\label{admin_guide}
В данном разделе приведены действия, которые необходимо произвести системному администратору для подключения и настройки разработанного PAM модуля.

\subsection{Подготовка модуля}
Прежде всего требуется собрать бинарные файлы. Необходимые для сборки шаги описаны в разделе~\ref{compilation}.

\subsection{Подготовка файла \t{/etc/u2sn}}
Требуется создать файл \t{/etc/u2sn} и заполнить его строками следующего вида:

\starttextblock
<имя_пользователя> <серийный_номер_USB_устройства>
\end{lstlisting}

Пользователи, которые не будут указаны в этом файле, {\bf не смогут} пройти аутентификацию после подключения модуля \emph{pam\_twofactor\_auth} к системе!

\subsection{Генерация ключей и паролей пользователей}
Для создания ключа пользователя требуется запустить программу \emph{aes\_generate} и ввести пароль, которым будет зашифрован ключ. Программа выдаст 2
строки:
\begin{itemize}
\item расшифрованный ключ, который нужно установить в качестве пароля пользователя;
\item зашифрованный ключ (с дополнительными данными для проверки корректности пароля к ключу при расшифровке), который нужно положить в файл
с именем \t{ptfa.key} на USB устройство.
\end{itemize}

Если на USB устройстве несколько разделов, то можно положить файл \t{ptfa.key} на любой из них. Но при этом требуется проверить, что на других разделах нет
такого файла с отличающимся содержимым, так как модуль будет использовать первый обнаруженный файл с именем \t{ptfa.key}. Порядок обнаружения зависит от
того, какие разделы в данный момент примонтированы, поэтому неизвестен заранее.

\subsection{Подключение модуля к ОС}
Для подключения модуля к операционной системе требуется отредактировать следующий конфигурационный файл:
\begin{itemize}
\item в ОС МСВС 3.0: \t{/etc/pam.d/system-auth};
\item в Ubuntu 12.04 и новее: \t{/etc/pam.d/common-auth}.
\end{itemize}

Перед строкой, которая начинается с \t{auth} и содержит \t{pam\_unix.so}, нужно написать строку:

\starttextblock
auth    requisite    </полный/путь/к/файлу/pam_twofactor_auth.so>
\end{lstlisting}

В конце строки, которая начинается с \t{auth} и содержит \t{pam\_unix.so}, требуется добавить параметр \t{try\_first\_pass} (если его в ней нет).

Пример того, как в итоге могут выглядеть добавленная и отредактированная строки вместе:

\starttextblock
auth    requisite     /root/twofactor_auth/build/pam_twofactor_auth.so
auth    sufficient    pam_unix.so likeauth nullok try_first_pass
\end{lstlisting}

После этого действия PAM модуль будет использоваться системой для любой аутентификации.

\section{Руководство для пользователя}
Пользователь должен следовать алгоритму, описанному в формулировке задачи (см. раздел ~\ref{task_statement}).

\section{To be erased}
В разделе содержаться инструкции по использованию компонента. Для программы, реализующей API
для  взаимодействия с другими компонентами (например, для DLL библиотеки), приводится описание
таких интерфейсов (спецификация входных параметров и возвращаемых значений).
