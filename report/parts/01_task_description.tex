\chapter{Постановка задачи}

\section{To be erased}
В разделе приводится анализ предложенной задачи с точки зрения ее реализуемости и наличия
эффективных алгоритмов. В случае предложения оригинальных алгоритмов решения задачи, необходимо
обоснование их корректности и эффективности.

\section{Формулировка}
\label{task_statement}
Требуется разработать средство обеспечения двухфакторной аутентификации (в формате PAM модуля)
пользователя в операционной системе МСВС 3.0 на основе предъявления им:
\begin{itemize}
\item внешнего USB устройства с заданным серийным номером;
\item пароля;
\item ключа пользователя (256 бит), зашифрованного на пароле, хранящегося на USB устройстве.
\end{itemize}

Алгоритм аутентификации должен включать следующую последовательность действий:
\begin{itemize}
\item USB устройство присоединяется к ПЭВМ;
\item пользователь вводит локальное имя;
\item проверяется соответствие имени серийному номеру устройства;
\item пользователь вводит пароль;
\item зашифрованный ключ пользователя считывается из USB устройства;
\item с использованием пароля производится расшифровка ключа.
\end{itemize}

Далее использовать стандартную процедуру аутентификации, где в качестве пароля используется ключ.
При неправильно введенном пароле запросить его повторный ввод.
Если число ошибок превышает заданный порог, учетная запись должна заблокироваться.

\section{Реализуемость и наличие эффективных алгоритмов}
\label{implementation_problems_and_algos}
Для реализации PAM модуля, описанного выше, необходимы следующие нетривиальные возможности:
\begin{enumerate}
\item создания PAM модуля аутентификации;
\item получение от PAM имени пользователя;
\item получение от PAM пароля к ключу;
\item определение наличия внешнего USB устройства с заданным серийным номером;
\item считывание зашифрованного ключа с USB устройства с заданным серийным номером;
\item расшифровка ключа паролем;
\item передача расшифрованного ключа в качестве пароля PAM;
\item подключение PAM модуля к системе.
\end{enumerate}

Для выполнения пункта 1 требуется создать динамическую библиотеку, реализующую функции \t{pam\_sm\_authenticate} и \t{pam\_sm\_setcred}.

Пункты 2, 3 и 7 выполнимы с помощью таких функций PAM как \t{pam\_get\_user}, \t{pam\_get\_item}, \t{pam\_set\_item} и нескольких других.

Пункты 4 и 5 потребовали тщательного изучения того, как реализовано взаимодействие с USB устройствами в операционной системе МСВС 3.0, и описаны
далее [?привести ref?].

Пункт 6 решается использованием библиотеки \emph{openssl}~\cite{openssl}. Был выбран алгоритм \emph{AES}. Кроме того, необходимо создать утилиту,
которая будет генерировать для пользователя ключ и шифровать его паролем.

Для выполнения пункта 8 требуется правильно прописать созданный PAM модуль в файле \t{/etc/pam.d/system-auth} и добавить модулю аутентификации
\emph{pam\_unix} параметр \t{try\_first\_pass}. Подробности далее.
